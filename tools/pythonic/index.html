<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Pythonic - Study Notes</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Pythonic";
        var mkdocs_page_input_path = "tools/pythonic.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Study Notes
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Introduction</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">AI</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../AI/d2l.md">Dive into Deep Learning</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Mathematics</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../mathematics/beauty_of_mathematics/">数学之美</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../mathematics/statistics_concepts_and_controversies/">统计学的世界</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Network</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../network/%E5%9B%BE%E8%A7%A3%E7%BD%91%E7%BB%9C/">图解网络</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Psychology & Mind</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../psychology/%E4%B8%8E%E4%BC%97%E4%B8%8D%E5%90%8C%E7%9A%84%E5%BF%83%E7%90%86%E5%AD%A6/">与众不同的心理学</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../psychology/%E5%86%B3%E7%AD%96%E4%B8%8E%E5%88%A4%E6%96%AD/">决策与判断</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../psychology/%E6%9A%97%E6%97%B6%E9%97%B4/">暗时间</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../psychology/%E4%BD%A0%E7%9A%84%E7%81%AF%E4%BA%AE%E7%9D%80%E5%90%97/">你的灯亮着吗</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../psychology/%E6%B2%9F%E9%80%9A%E7%9A%84%E8%89%BA%E6%9C%AF/">沟通的艺术</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../psychology/%E5%BD%B1%E5%93%8D%E5%8A%9B/">影响力</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../psychology/%E4%B8%93%E6%B3%A8%E5%8A%9B/">专注力</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Startup</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../startup/how_google_works/">How Google Works</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../startup/how_to_start_a_startup/">YC startup course</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Tools</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../archlinux/">arch linux</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bash/">bash</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../practical_vim/">vim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../neovim/">neovim</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../git/">git</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../docker/">docker</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../python/python3.md">python3</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="../../python/pythonic.md">pythonic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Other</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../research/像外行一样思考，像专家一样实践.md">像外行一样思考，像专家一样实践</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../other/history_of_quantum_physics/">上帝掷骰子吗？量子物理史话</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../other/%E9%AB%98%E6%95%88%E8%83%BD%E4%BA%BA%E5%A3%AB%E7%9A%847%E4%B8%AA%E4%B9%A0%E6%83%AF/">高效能人士的7个习惯</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../other/%E5%BA%95%E5%B1%82%E9%80%BB%E8%BE%91/">底层逻辑</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../other/%E9%AB%98%E6%95%88%E7%A8%8B%E5%BA%8F%E5%91%98%E7%9A%8445%E4%B8%AA%E4%B9%A0%E6%83%AF/">高效程序员的45个习惯</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../other/type_system/">Type System</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../other/principles/">Principles</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Todo</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="../../todo/readling_list.md">TODO</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Study Notes</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li class="breadcrumb-item active">Pythonic</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="pythonic">Pythonic</h1>
<h2 id="idiomatic-python">Idiomatic Python</h2>
<p><a href="https://intermediate-and-advanced-software-carpentry.readthedocs.io/en/latest/idiomatic-python.html">Idiomatic Python</a></p>
<ul>
<li>reverse list a: <code>a[::-1]</code></li>
<li><code>string.join(iterable)</code></li>
<li>use <code>zip</code>, <code>list(zip(a,b))</code>, <code>dict(zip(a,b))</code></li>
<li>open file</li>
</ul>
<pre><code class="language-python">with open('filename', 'r') as f:
    f.read()
</code></pre>
<ul>
<li><code>iter()</code>连续调用函数</li>
<li>for/else, try/else, while/else</li>
<li>dict:
  popitem()是原子操作</li>
</ul>
<pre><code class="language-python">while d:
    key, value = d.popitem()
</code></pre>
<p>连接多个字典
<code>d = ChainMap(command_line_args, os.environ, defaults)</code></p>
<ul>
<li>deque 更有效，两端都可操作，<code>Q = collections.deque()</code>，<code>append(), appendleft(),
extend(), extendleft(), pop(), popleft()</code></li>
<li>
<p>collections: deque, namedtuple, counter, defaultdict, etc.</p>
</li>
<li>
<p>decorator: 装饰器事实上就是一个函数到另一个函数的映射，可以在不修改原函数代码的情况下为其增加新的功能。本质上，decorator 就是一个返回函数的高阶函数。</p>
</li>
<li>
<p>使用 ignored()代替 pass exception，例如</p>
</li>
</ul>
<pre><code class="language-python">try:
    os.remove('somefile.tmp')
except OSError:
    pass
</code></pre>
<p>改成</p>
<pre><code class="language-python">with ignored(OSError):
    os.remove('somefile.tmp')
</code></pre>
<ul>
<li>两个冲突的原则： 1.一行不要有太多逻辑 2.不要把单一的想法拆分成多个部分</li>
<li>Raymond 的原则：一行代码的逻辑等价于一句自然语言</li>
<li>列表解析和生成器<code>sum(i**2 for i in range(10))</code></li>
<li>函数嵌套定义</li>
</ul>
<pre><code class="language-python">def my_func():
    def subfunc():
        ...
    subfunc()
    ...
</code></pre>
<ul>
<li>
<p>with 比起 try...finally...来说，更强调"作用域"</p>
</li>
<li>
<p>any</p>
</li>
</ul>
<pre><code class="language-py">def has_primary_key():
    return any(row[1] ==0 and row[9] != 'YES' for row in rows:)
</code></pre>
<ul>
<li>namedtuple</li>
</ul>
<pre><code class="language-python">Point = collections.namedtuple('Point', ['x', 'y'])
p = Point(x=1.0, y=2.0)
p.x
p.y
</code></pre>
<ul>
<li>
<p>map/filter/reduce 与列表推导</p>
</li>
<li>
<p>map 是从一个集合到另一个集合的映射，比如已知集合 lst，要得到每一项平方组成的新集合：</p>
</li>
</ul>
<pre><code class="language-python">  lst = [1,2,3]
  map(lambda item: item**2, lst)
  [item**2 for item in lst]
</code></pre>
<ul>
<li>filter 也可以通过列表推导来实现，比如已知集合 lst，要得到奇数的平方的新集合：</li>
</ul>
<pre><code class="language-python">  [item**2 for item in lst if item % 2]
  map(lambda item: item**2, filter(lambda item: item % 2, lst))
</code></pre>
<ul>
<li>reduce 把结果继续和序列的下一个元素做累积计算</li>
</ul>
<pre><code class="language-python">  reduce(f, [x1, x2, x3, x4]) = f(f(f(x1, x2), x3), x4)
  from functools import reduce
  reduce(lambda x,y: x+y, [1,2,3,4]) # 10
</code></pre>
<ul>
<li>lambda 表达式 <code>add = lambda x,y : x+y</code></li>
<li>yield 的作用就是把一个函数变成一个 generator，使用 yield 的好处在于，它返回的是一个 generator 生成器</li>
<li>generator 生成器，列表推导用[]进行生成，把[]换成()，就创建了一个 generator：</li>
</ul>
<pre><code class="language-python">  # L是一个list，g是一个generator，而generator是可迭代的
  L = [x*x for x in range(10)] # [0, 1, 4, 9, 16, 25, 36, 49, 64, 81]
  g = (x*x for x in range(10)) # &lt;generator object &lt;genexpr&gt; at 0x7fd2264607d8&gt;
</code></pre>
<ul>
<li><code>__slots__</code> Magic: save RAM instead of using dict</li>
<li>List comprehensions: <code>[expression for var in list if conditional]</code></li>
<li><strong>Generators</strong> are a Python implementation of coroutines. Essentially, they’re functions that let you suspend execution and return a result.</li>
<li><strong>Assert</strong> is pretty simple: it takes a boolean, and if the boolean evaluates to False, it fails (by raising an AssertionError exception). assert True is a no-op.</li>
</ul>
<h2 id="python-tips">Python Tips</h2>
<p>Tips collected from <a href="http://book.pythontips.com/en/latest/index.html">python tips</a></p>
<ul>
<li><code>*args</code> and <code>**kwargs</code></li>
</ul>
<p><code>*args</code>: non-keyworded
<code>**kwargs</code>: allow you to pass keyworded variable length of arguments to a
function.</p>
<ul>
<li>Debugging: python debugger (pdb)</li>
</ul>
<p>running from command line:</p>
<p><code>python -m pdb my_code.py</code></p>
<p>running inside a script:</p>
<pre><code class="language-python">import pdb
def make_bread():
    pdb.set_trace() # set break points
    return &quot;I don't have time&quot;

print(make_bread())
</code></pre>
<ul>
<li>pdb usage</li>
</ul>
<table>
<thead>
<tr>
<th>shortcut</th>
<th>meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td>c</td>
<td>continue execution</td>
</tr>
<tr>
<td>w</td>
<td>show context of current line it is executing</td>
</tr>
<tr>
<td>a</td>
<td>print the argument list of current function</td>
</tr>
<tr>
<td>s</td>
<td>execute the current line and stop at the first possible occasion</td>
</tr>
<tr>
<td>n</td>
<td>continue execution until the next line in the current function is reached or it returns</td>
</tr>
</tbody>
</table>
<ul>
<li>Ternary Operators</li>
</ul>
<p>Ternary operators are more commonly known as conditional expressions in
Python.</p>
<p><code>condition if true if condition else condition if false</code></p>
<p><code>state = "nice" if condition else "not nice"</code></p>
<ul>
<li>
<p>Decorators are functions which modify the functionality of other functions.</p>
<p>1) Define functions within functions;</p>
<p>2) Return functions from within functions;</p>
<p>3) Give a function as an argument to another function.</p>
</li>
<li>
<p>Don't use global.</p>
</li>
<li>Mutable means "able to be changed", immutable means "constant". In Python, the default arguments are evaluated once when the function is defined, not each time the function is called. You should never define default arguments of mutable type unless you know what you are doing.</li>
</ul>
<table>
<thead>
<tr>
<th></th>
<th>Data types</th>
</tr>
</thead>
<tbody>
<tr>
<td>mutable</td>
<td>list, dict, set</td>
</tr>
<tr>
<td>immutable</td>
<td>int, float, bool, string, tuple</td>
</tr>
</tbody>
</table>
<ul>
<li><code>__slots__</code> Magic</li>
</ul>
<p>Python uses dict to store an object's instance attributes, which sucks a lot of
RAM. Using <code>__slots__</code> to tell python not to use a dict, and only allocate space
for a fixed set of attributes, i.e., save RAM instead of using dict.</p>
<p>Example:</p>
<pre><code class="language-python"># without __slots__
class MyClass(object):
    def __init__(self, name, uid):
        self.name = name
        self.id = uid
        self.set_up()

# with __slots__ (40%-50% reduction of RAM)
class MyClass(object):
    __slots__ = ['name', 'uid']
    def __init__(self, name, uid):
        self.name = name
        self.id = uid
        self.set_up()
</code></pre>
<ul>
<li>
<p>Collections, container data types (defaultdict, OrderedDict, counter, deque,
  namedtuple, enum.Enum)</p>
</li>
<li>
<p>Object introspection</p>
</li>
<li>
<p><code>dir(list)</code> to get all the methods of a list;</p>
</li>
<li>
<p><code>type(object)</code> returns the type of an object, <code>id(object)</code> returns the
     unique id of an object;</p>
</li>
<li>
<p>insepct module, <code>import inspect</code>,
     <code>inspect.getmembers(str)</code></p>
</li>
<li>
<p>list/dict/set/generator comprehensions</p>
</li>
<li>
<p>Exceptions</p>
</li>
<li>
<p>try/except</p>
</li>
</ul>
<pre><code class="language-python">try:
    file = open(filename, 'rb')
except IOError as e:
    print(f'An IOError occured. {e.args[-1]}')
</code></pre>
<ol>
<li>Handling multiple exceptions</li>
</ol>
<pre><code class="language-python"># method 1
except (IOError, EOFError) as e:
    print(f'An Error occured. {e.args[-1]}')
    raise e
# method 2
except IOError as e:
    print(&quot;An IO error occurred.&quot;)
    raise e
except EOFError as e:
    print(&quot;An EOF error occurred.&quot;)
    raise e
# method 3
except (IOError, EOFError) as e:
    # some logging
    raise e
</code></pre>
<ol>
<li>finally</li>
</ol>
<pre><code class="language-python">try:
    file = open('test.txt', 'rb')
except IOError as e:
    print('An IOError occurred. {}'.format(e.args[-1]))
finally:
    print(&quot;This would be printed whether or not an exception occurred!&quot;)
</code></pre>
<ol>
<li>try/else</li>
</ol>
<pre><code class="language-python">try:
    print('I am sure no exception is going to occur!')
except Exception:
    print('exception')
else:
    # any code that should only run if no exception occurs in the try,
    # but for which exceptions should NOT be caught
    print('This would only run if no exception occurs. And an error here '
          'would NOT be caught.')
finally:
    print('This would be printed in every case.')
</code></pre>
<ul>
<li>Lambdas (one line functions, anoymous), blueprint: <code>lambda arguments: manipulate(arguments)</code></li>
<li>Profiling a script. This can be extremely helpful in pinpointing the bottlenecks in your script:</li>
</ul>
<p><code>python -m cProfile my_script.py</code></p>
<p>(cProfile is a faster implementation of profile as it is written in C)</p>
<ul>
<li>for/else: else condition executes when no break happens</li>
<li>Python C extensions: ctypes</li>
<li><code>open()</code>, syntax: <code>open(filename, mode)</code></li>
</ul>
<table>
<thead>
<tr>
<th>mode</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>r</td>
<td>read</td>
</tr>
<tr>
<td>r+</td>
<td>read and write</td>
</tr>
<tr>
<td>w</td>
<td>overwrite</td>
</tr>
<tr>
<td>a</td>
<td>append</td>
</tr>
<tr>
<td>b</td>
<td>binary</td>
</tr>
</tbody>
</table>
<ul>
<li>Coroutines: similar to generators with a few differences. Generators are data
  producers. Coroutines are data consumers</li>
</ul>
<pre><code class="language-python"># generator
def fib():
    a,b = 0,1
    while 1:
        yield a
        a,b = b,a+b
# coroutine
def grep(pattern):
    print(&quot;Searching for&quot;, pattern)
    while 1:
        line = (yield)
        if pattern in line:
            print(line)

search = grep('coroutine')
next(search)
search.send(&quot;hahaha&quot;)
search.send(&quot;I love coroutines!&quot;)
# ...
search.close()
</code></pre>
<ul>
<li>Function Caching: Function caching allows us to cache the return values of a function depending on the arguments.</li>
</ul>
<pre><code class="language-python">from functools import lru_cache

@lru_cache(maxsize=32)
def fib(n):
    if n &lt; 2:
        return n
    return fib(n-1) + fib(n-2)

print([fib(n) for n in range(10)])
# Output: [0, 1, 1, 2, 3, 5, 8, 13, 21, 34]
fib.cache_clear()
</code></pre>
<ul>
<li>Context Managers: Context managers allow you to allocate and release resources precisely when you want to. The most widely used example of context manager is <code>with</code>.</li>
</ul>
<pre><code class="language-python"># Implementing a Context Manager as a Class
# a context manager has an __enter__ and __exit__ method defined
class File(object):
    def __init__(self, file_name, method):
        self.file_obj = open(file_name, method)
    def __enter__(self):
        return self.file_obj
    def __exit__(self, type, value, traceback):
        return self.file_obj.close()

with File('demo.txt', 'w') as opened_file:
    opened_file.write('Hola!')

# Handling Exceptions
class File(object):
     def __init__(self, file_name, method):
         self.file_obj = open(file_name, method)
     def __enter__(self):
         return self.file_obj
     def __exit__(self, type, value, traceback):
         print(&quot;Exception has been handled&quot;)
         self.file_obj.close()
         return True

with File('demo.txt', 'w') as opened_file:
    opened_file.undefined_function()

# Implementing a Context Manager as a generator
from contextlib import contextmanager

@contextmanager
def open_file(name):
    f = open(name, 'w')
    yield f
    f.close()

with open_file('some_file') as f:
    f.write('hola!')
</code></pre>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
